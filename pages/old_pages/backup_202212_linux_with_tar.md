# setup

https://askubuntu.com/questions/7809/how-to-back-up-my-entire-system

list generated by:
```
dpkg --get-selections | grep -v deinstall > ubuntu-files
```

to install on new system:
```
sudo dpkg --set-selections <./ubuntu-files (will set it up and)

apt-get -y update
apt-get dselect-upgrade
```

also, archives of the package caches have been placed in apt_archives
```
dpkg -i *.deb
```

with:
```
rsync -avp /var/cache/apt/archives*.deb

------

# backup conducted: 

```
sudo tar \
    --create \
    --multi-volume \ 
    --tape-length=4G \
    --verbose \
    --lzop \ 
    --file=/media/arx/crypt/backups/laptops/razorblade_stealth/linux_partition/backup_l2arx_$(date -I).tar.lzop \
    --exclude=/media/arx/crypt/backups/laptops/razorblade_stealth/linux_partition/backup_l2arx_$(date -I).tar.lzop \
    --exclude=/dev \
    --exclude=/mnt \
    --exclude=/proc \
    --exclude=/sys \
    --exclude=/tmp \
    --exclude=/media \
    --exclude=/lost+found \
    /
```

## w/o multi: 
using lzop w/ about 30% compression at 1/10th the cpu of gzip
https://www.lzop.org/
- dropping sudo since it keeps crashing with permission denied errors
```
tar \
    --create \
    --verbose \
    --lzop \ 
    --file=/media/arx/crypt/backups/laptops/razorblade_stealth/linux_partition/backup_l2arx_$(date -I).tar.lzop \
    --exclude=/dev \
    --exclude=/mnt \
    --exclude=/proc \
    --exclude=/sys \
    --exclude=/tmp \
    --exclude=/media \
    --exclude=/lost+found \
    / 2>tar.errors | tee tar.output
```

## multi-file, (can't use  compression)
```
sudo tar \
    --create \
    --multi-volume \ 
    --tape-length=4G \
    --verbose \
    --file=/media/arx/crypt/backups/laptops/razorblade_stealth/linux_partition/backup_l2arx_$(date -I).tar \
    --exclude=/dev \
    --exclude=/mnt \
    --exclude=/proc \
    --exclude=/sys \
    --exclude=/tmp \
    --exclude=/media \
    --exclude=/lost+found \
    / 2>tar.errors | tee tar.output
```

```
tar -dvf backup_l2arx_2022-12-24.tar.lzop / 2>backup_l2arx_$(date -I)_verification_errors | tee backup_l2arx_$(date -I)_verification
```

## w progress: 

```
pv backup_l2arx_2022-12-24.tar.lzop | tar dvf - --lzop /
```
## for multi volume

#+begin_src sh :output raw
echo "test"

#! /bin/bash
# For this script it's advisable to use a shell,?s such as Bash,
# that supports a TAR_FD value greater than 9.

echo Preparing volume $TAR_VOLUME of $TAR_ARCHIVE.

name=`expr $TAR_ARCHIVE : '\(.*\)-.*'`
case $TAR_SUBCOMMAND in
-c)       ;;
-d|-x|-t) test -r ${name:-$TAR_ARCHIVE}-$TAR_VOLUME || exit 1
          ;;
*)        exit 1
esac

echo ${name:-$TAR_ARCHIVE}-$TAR_VOLUME >&$TAR_FD

#+end_src
```
to restore: 
```
tar xf /path/to/drive/with/backup.tar.gz -C /mnt
```
